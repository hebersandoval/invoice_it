<!DOCTYPE html>
<html lang="en">
    <%- include('../partials/head') %>
    <body>
        <%- include('../partials/nav') %>

        <!-- Content body here -->
        <main id="dashboardPage" class="">
            <div class="dashboard-layout">

                <%- include('../partials/sidebar') %>

                <div class="dashboard-content">
                    <h2><%= title %></h2>
                    <p>Welcome to your dashboard! You are now logged in.</p>
                    <section>
                        <h3>Recent Activity</h3>
                        <p>Your recent activity will appear here.</p>
                    </section>

                    <!-- Statistics section -->
                    <section>
                        <h3>Statistics</h3>
                        <div class="stats">
                            <div class="stat-card">
                                <h3><%= USDollar.format(totalPaid) %></h3>
                                <p>Collected</p>
                            </div>
                            <div class="stat-card">
                                <h3><%= USDollar.format(totalPending) %></h3>
                                <p>Pending</p>
                            </div>
                            <div class="stat-card">
                                <h3><%= invoiceCount %></h3>
                                <p>Total invoices</p>
                            </div>
                            <div class="stat-card">
                               <h3><%= customerCount %></h3>
                               <p>Total customers</p> 
                            </div>
                        </div>
                    </section>

                    <!-- Two column layout for revenue and invoices -->
                    <section>
                        <div class="stats">
                            <!-- Recent revenue box -->
                            <div class="stat-card">
                                <h3>Recent Revenue</h3>
                                <p>Monthly revenue breakdown and trends for the current quarter.</p>

                                <!-- Load chart here -->
                                <canvas id="revenueChart" width="600" height="400"></canvas>
                                <p>Last 6 months</p>
                            </div>
                            <!-- Latest invoices box -->
                            <div class="stat-card">
                                <h3>Latest Invoices</h3>
                                <p>View your most recent invoice transactions and their status.</p>

                                <!-- Invoice list -->
                                 <% latestInvoices.forEach(invoice => { %>
                                    <div class="invoice-item">
                                        <span><%= invoice.customer.name %></span>
                                        <% if(invoice.status === 'paid') { %>
                                            <span class="status status-paid">Paid</span>
                                        <% } else { %>
                                            <span class="status status-pending">Pending</span>
                                        <% } %>
                                        <span><%= USDollar.format(invoice.amount) %></span>
                                    </div>
                                <% }) %>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>

        <%- include('../partials/footer') %>

        <!-- Scripts -->
        <%- include('../partials/script') %>
    </body>
</html>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const canvas = document.getElementById('revenueChart');
    const revenueData = JSON.parse('<%- revenueData %>');

    new Chart(canvas, {
        type: 'bar',
        data: {
            labels: revenueData.map(item => item.month),
            datasets: [{
                label: 'Revenue',
                data: revenueData.map(item => item.revenue),
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1,
            }],
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                },
            },
        },
    });
</script>