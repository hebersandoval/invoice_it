<!-- Customer's search bar -->
<section>
    <form>
        <%- include('../partials/formErrors') %>

        <div style="max-width: 500px;">
            <!-- <label for="search">Name</label> -->
            <input 
                type="text" 
                id="search" 
                name="search" 
                placeholder="Search invoices..."
                />

            <button type="submit">Search</button>
            <!-- <a href="/dashboard/invoices" style="margin-left: 1rem; color: #3498db;">Clear</a> -->
            <a href="invoices/create" style="margin-left: 1rem; color: #3498db;">New invoice</a>
        </div>
    </form>
</section>

<!-- Customer's table -->
<section>
    <h2>Invoices</h2>
    <table>
        <thead>
        <tr>
            <th>Customer name</th>
            <th>Amount</th>
            <th>Due date</th>
            <th>Status</th>
            <th></th>
        </tr>
        </thead>

        <tbody>
        <% invoices.forEach(function(invoice){ %>
            <tr>
                <td> <%= invoice.customer.name %> </td>
                <td> <%= invoice.amount %> </td>
                <td> <%= new Date(invoice.date).toLocaleDateString('en-US') %> </td>
                <td> 
                    <% if(invoice.status === 'paid') { %>
                        Paid
                    <% } else { %>
                       Pending 
                    <% } %>
                </td>
                <td style="padding: 1rem; text-align: center">
                    <!-- Edit Link -->
                    <a
                        href="invoices/<%= invoice._id %>/edit"
                        style="color: #3498db; margin-right: 1.5rem; font-weight: 500"
                    >
                        Edit
                    </a>

                    <!-- Delete Form (POST for safety) -->
                    <!-- <form
                        action="invoices/<%# invoice._id %>/delete"
                        method="POST"
                        style="display: inline"
                        onsubmit="return confirm('Are you sure you want to delete <%# invoice._id %>? This action cannot be undone.');"
                    >
                        <button
                            type="submit"
                            style="
                                background: #e74c3c;
                                padding: 0.5rem 1rem;
                                font-size: 0.9rem;
                                border: none;
                                border-radius: 4px;
                                color: white;
                                cursor: pointer;
                            "
                        >
                            Delete me
                        </button>
                    </form> -->

                    <!-- Uses a modal -->
                    <button class="btn btn-danger" onclick="deleteModal('<%= invoice._id %>')">Delete</button>
                </td>
            </tr>
        <% }); %>
        </tbody>
    </table>
</section>

<!-- Delete Confirmation Modal -->
<dialog id="delete-modal">
    <div
        style="
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            max-width: 400px;
            width: 90%;
            margin: auto;
        "
    >
        <h3 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem; color: #2c3e50">Are you sure?</h3>
        <p style="padding: 1rem 0; color: #333; line-height: 1.6">
            The invoice will be permanently deleted. This action cannot be undone.
        </p>

        <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem">
            <!-- Cancel Button (closes dialog) -->
            <form method="dialog" style="display: inline">
                <button
                    type="submit"
                    style="
                        background: #bdc3c7;
                        color: #2c3e50;
                        padding: 0.75rem 2rem;
                        border: none;
                        border-radius: 4px;
                        font-size: 1rem;
                        cursor: pointer;
                    "
                    onmouseover="this.style.background='#95a5a6'"
                    onmouseout="this.style.background='#bdc3c7'"
                >
                    Cancel
                </button>
            </form>

            <!-- Confirm Delete Button -->
            <form id="delete-form" method="POST" style="display: inline">
                <button
                    type="submit"
                    style="
                        background: #e74c3c;
                        color: white;
                        padding: 0.75rem 2rem;
                        border: none;
                        border-radius: 4px;
                        font-size: 1rem;
                        cursor: pointer;
                    "
                    onmouseover="this.style.background='#c0392b'"
                    onmouseout="this.style.background='#e74c3c'"
                >
                    Yes, Delete
                </button>
            </form>
        </div>
    </div>
</dialog>


<script>
  function deleteModal(invoiceId){
    const modal = document.querySelector('#delete-modal');
    const deleteForm = document.querySelector('#delete-form');
    deleteForm.setAttribute('action', `invoices/${invoiceId}/delete`)
    modal.showModal();
  }
</script>

